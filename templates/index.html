<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Alerta Inclusiva - Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Alerta de emergencia -->
    <div id="alerta-emergencia" class="alerta-emergencia oculto">
        <div class="alerta-contenido">
            <button class="btn-cerrar-alerta" onclick="cerrarAlertaManual()" title="Cerrar alerta">
                âœ•
            </button>
            <div class="alerta-icono">âš ï¸</div>
            <h2>Â¡ALERTA DE EMERGENCIA!</h2>
            <p id="alerta-mensaje">Niveles peligrosos detectados</p>
            <div class="alerta-detalles">
                <span id="alerta-temp"></span>
                <span id="alerta-humo"></span>
            </div>
            <button class="btn-alerta-accion" onclick="cerrarAlertaManual()">
                Entendido
            </button>
        </div>
    </div>

    <header>
        <div class="header-top">
            <h1>ğŸ”” Sistema Multisensorial de Alerta Inclusiva</h1>
            {% if usuario %}
            <div class="header-usuario">
                <span class="usuario-badge">ğŸ‘¤ {{ usuario }}</span>
                <a href="/perfil" class="btn-header btn-perfil">
                    <span class="btn-icono">âš™ï¸</span>
                    <span class="btn-texto">Perfil</span>
                </a>
                <a href="/logout" class="btn-header btn-logout">
                    <span class="btn-icono">ğŸšª</span>
                    <span class="btn-texto">Salir</span>
                </a>
            </div>
            {% endif %}
        </div>
        <div class="estado-conexion">
            <span id="estado-conexion" class="conectado">â— Conectado</span>
            <span id="ultima-actualizacion">Ãšltima actualizaciÃ³n: --:--:--</span>
        </div>
    </header>

    <div class="container">
        <!-- Panel de lecturas en tiempo real -->
        <section class="panel-principal">
            <h2>ğŸ“Š Lecturas en Tiempo Real</h2>
            
            <div class="medidores-grid">
                <!-- Medidor de Temperatura -->
                <div class="medidor-card">
                    <div class="medidor-header">
                        <span class="icono">ğŸŒ¡ï¸</span>
                        <h3>Temperatura</h3>
                    </div>
                    <div class="medidor-valor">
                        <span id="temp-valor" class="valor-grande">--</span>
                        <span class="unidad">Â°C</span>
                    </div>
                    <div id="temp-estado" class="estado-indicador bajo">
                        <span class="estado-texto">BAJO</span>
                    </div>
                    <div class="umbral-info">
                        <small>Umbral de peligro: <strong>60Â°C</strong></small>
                    </div>
                </div>

                <!-- Medidor de Humo -->
                <div class="medidor-card">
                    <div class="medidor-header">
                        <span class="icono">ğŸ’¨</span>
                        <h3>Humo / Gases</h3>
                    </div>
                    <div class="medidor-valor">
                        <span id="humo-valor" class="valor-grande">--</span>
                        <span class="unidad">ppm</span>
                    </div>
                    <div id="humo-estado" class="estado-indicador bajo">
                        <span class="estado-texto">BAJO</span>
                    </div>
                    <div class="umbral-info">
                        <small>Umbral de peligro: <strong>400 ppm</strong></small>
                    </div>
                </div>
            </div>

            <!-- Panel de Controles -->
            <div class="controles-panel">
                <h3>ğŸ›ï¸ Panel de Control</h3>
                
                <!-- BotÃ³n de Emergencia Manual -->
                <div class="control-grupo">
                    <h4>ğŸš¨ BOTÃ“N DE EMERGENCIA MANUAL</h4>
                    <div class="botones-control">
                        <button class="btn-control btn-emergencia" onclick="activarEmergenciaManual()">
                            <span class="btn-icono">ğŸš¨</span>
                            <span class="btn-texto">ACTIVAR EMERGENCIA</span>
                        </button>
                    </div>
                    <p class="control-descripcion">
                        Al activar: Se encenderÃ¡ el ventilador de evacuaciÃ³n y se abrirÃ¡n las puertas automÃ¡ticamente
                    </p>
                </div>

                <!-- Control de Ventilador -->
                <div class="control-grupo">
                    <h4>ğŸŒ€ Ventilador de EvacuaciÃ³n</h4>
                    <div class="botones-control">
                        <button class="btn-control btn-ventilador-on" onclick="encenderVentilador()">
                            <span class="btn-icono">ğŸŒ€</span>
                            <span class="btn-texto">Encender Ventilador</span>
                        </button>
                        <button class="btn-control btn-ventilador-off" onclick="apagarVentilador()">
                            <span class="btn-icono">â¹ï¸</span>
                            <span class="btn-texto">Apagar Ventilador</span>
                        </button>
                    </div>
                    <p class="control-descripcion">
                        El ventilador ayuda a evacuar humo y gases en caso de emergencia
                    </p>
                </div>

                <!-- Control de Servomotores -->
                <div class="control-grupo">
                    <h4>ğŸšª Puertas de EvacuaciÃ³n (Servomotores)</h4>
                    <div class="botones-control">
                        <button class="btn-control btn-servo-abrir" onclick="abrirPuertas()">
                            <span class="btn-icono">ğŸ”“</span>
                            <span class="btn-texto">Abrir Puertas</span>
                        </button>
                        <button class="btn-control btn-servo-cerrar" onclick="cerrarPuertas()">
                            <span class="btn-icono">ğŸ”’</span>
                            <span class="btn-texto">Cerrar Puertas</span>
                        </button>
                    </div>
                    <p class="control-descripcion">
                        Control automÃ¡tico de puertas/ventanas para facilitar la evacuaciÃ³n
                    </p>
                </div>
            </div>
        </section>

        <!-- Resto del cÃ³digo se mantiene igual -->
        <!-- GrÃ¡ficos histÃ³ricos -->
        <section class="graficos-section">
            <h2>ğŸ“ˆ HistÃ³rico de Lecturas</h2>
            
            <div class="grafico-container">
                <h3>Temperatura (Ãšltimos 50 registros)</h3>
                <canvas id="grafico-temperatura"></canvas>
            </div>
            
            <div class="grafico-container">
                <h3>Humo (Ãšltimos 50 registros)</h3>
                <canvas id="grafico-humo"></canvas>
            </div>
        </section>

        <!-- Registro de alertas -->
        <section class="alertas-section">
            <h2>ğŸš¨ Registro de Alertas</h2>
            <div id="lista-alertas" class="lista-alertas">
                <p class="sin-alertas">No hay alertas registradas</p>
            </div>
        </section>

        <!-- Leyenda de niveles -->
        <section class="leyenda-section">
            <h3>ğŸ“‹ Niveles de Alerta</h3>
            <div class="leyenda-grid">
                <div class="leyenda-item bajo">
                    <span class="leyenda-color"></span>
                    <div>
                        <strong>BAJO</strong>
                        <p>Temp: &lt;25Â°C | Humo: &lt;100 ppm</p>
                    </div>
                </div>
                <div class="leyenda-item normal">
                    <span class="leyenda-color"></span>
                    <div>
                        <strong>NORMAL</strong>
                        <p>Temp: 25-40Â°C | Humo: 100-200 ppm</p>
                    </div>
                </div>
                <div class="leyenda-item alto">
                    <span class="leyenda-color"></span>
                    <div>
                        <strong>ALTO</strong>
                        <p>Temp: 40-50Â°C | Humo: 200-300 ppm</p>
                    </div>
                </div>
                <div class="leyenda-item peligro">
                    <span class="leyenda-color"></span>
                    <div>
                        <strong>PELIGRO</strong>
                        <p>Temp: &gt;60Â°C | Humo: &gt;400 ppm</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <footer>
        <p>Sistema Multisensorial de Alerta Inclusiva para Aulas | Basado en Arduino + MQ-2 + DHT11</p>
        <p><small>Proyecto de IngenierÃ­a de Software - Universidad de Milagro</small></p>
    </footer>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>