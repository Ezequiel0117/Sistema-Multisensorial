<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Alerta Inclusiva - Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="alerta-emergencia" class="alerta-emergencia oculto">
        <div class="alerta-contenido">
            <button class="btn-cerrar-alerta" onclick="cerrarAlertaManual(event)" title="Cerrar alerta">
                âœ•
            </button>
            <div class="alerta-icono">âš ï¸</div>
            <h2>Â¡ALERTA DE EMERGENCIA!</h2>
            <p id="alerta-mensaje">Niveles peligrosos detectados</p>
            <div class="alerta-detalles">
                <span id="alerta-temp">ğŸŒ¡ï¸ --Â°C</span>
                <span id="alerta-humo">ğŸ’¨ -- ppm</span>
            </div>
            <button class="btn-alerta-accion" onclick="cerrarAlertaManual(event)">
                Entendido
            </button>
        </div>
    </div>

    <header>
        <div class="header-top">
            <h1>ğŸ”” Sistema Multisensorial de Alerta Inclusiva</h1>
            {% if usuario %}
            <div class="header-usuario">
                <span class="usuario-badge">
                    {% if es_admin %}
                    ğŸ‘‘ {{ usuario }} (Admin)
                    {% else %}
                    ğŸ‘¤ {{ usuario }}
                    {% endif %}
                </span>
                <a href="/perfil" class="btn-header btn-perfil">
                    <span class="btn-icono">âš™ï¸</span>
                    <span class="btn-texto">Perfil</span>
                </a>
                <a href="/logout" class="btn-header btn-logout">
                    <span class="btn-icono">ğŸšª</span>
                    <span class="btn-texto">Salir</span>
                </a>
            </div>
            {% endif %}
        </div>
        <div class="estado-conexion">
            <span id="estado-conexion" class="conectado">â— Conectado</span>
            <span id="ultima-actualizacion">Ãšltima actualizaciÃ³n: --:--:--</span>
        </div>
    </header>

    {% if es_admin %}
    <section class="panel-admin">
        <div class="container">
            <h2>ğŸ›ï¸ Panel de Control de Administrador</h2>
            
            <div class="controles-admin-grid">
                <div class="control-admin-card">
                    <h4>ğŸš¨ EMERGENCIA MANUAL</h4>
                    <button class="btn-control btn-emergencia" onclick="activarEmergenciaManual()">
                        <span class="btn-icono">ğŸš¨</span>
                        <span class="btn-texto">ACTIVAR EMERGENCIA</span>
                    </button>
                    <p class="control-descripcion">
                        Activa ventilador y abre puerta automÃ¡ticamente
                    </p>
                </div>

                <div class="control-admin-card">
                    <h4>ğŸŒ€ VENTILADOR</h4>
                    <div class="botones-control">
                        <button class="btn-control btn-ventilador-on" onclick="encenderVentilador()">
                            <span class="btn-icono">ğŸŒ€</span>
                            <span class="btn-texto">Encender</span>
                        </button>
                        <button class="btn-control btn-ventilador-off" onclick="apagarVentilador()">
                            <span class="btn-icono">â¹ï¸</span>
                            <span class="btn-texto">Apagar</span>
                        </button>
                    </div>
                </div>

                <div class="control-admin-card">
                    <h4>ğŸšª PUERTA</h4>
                    <div class="botones-control">
                        <button class="btn-control btn-servo-abrir" onclick="abrirPuertas()">
                            <span class="btn-icono">ğŸ”“</span>
                            <span class="btn-texto">Abrir</span>
                        </button>
                        <button class="btn-control btn-servo-cerrar" onclick="cerrarPuertas()">
                            <span class="btn-icono">ğŸ”’</span>
                            <span class="btn-texto">Cerrar</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    {% endif %}

    <div class="container">
        <section class="leyenda-section">
            <h2>ğŸ“‹ Niveles de Alerta</h2>
            <div class="leyenda-grid">
                <div class="leyenda-item bajo">
                    <span class="leyenda-color"></span>
                    <div>
                        <strong>BAJO</strong>
                        <p>Temp: &lt;20Â°C | Humo: &lt;100 ppm</p>
                    </div>
                </div>
                <div class="leyenda-item normal">
                    <span class="leyenda-color"></span>
                    <div>
                        <strong>NORMAL</strong>
                        <p>Temp: 20-30Â°C | Humo: 100-300 ppm</p>
                    </div>
                </div>
                <div class="leyenda-item alto">
                    <span class="leyenda-color"></span>
                    <div>
                        <strong>ALTO</strong>
                        <p>Temp: 30-45Â°C | Humo: 300-600 ppm</p>
                    </div>
                </div>
                <div class="leyenda-item peligro">
                    <span class="leyenda-color"></span>
                    <div>
                        <strong>PELIGRO</strong>
                        <p>Temp: â‰¥45Â°C | Humo: â‰¥600 ppm</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="panel-principal">
            <h2>ğŸ“Š Lecturas en Tiempo Real</h2>
            
            <div class="medidores-grid">
                <div class="medidor-card">
                    <div class="medidor-header">
                        <span class="icono">ğŸŒ¡ï¸</span>
                        <h3>Temperatura</h3>
                    </div>
                    <div class="medidor-valor">
                        <span id="temp-valor" class="valor-grande">--</span>
                        <span class="unidad">Â°C</span>
                    </div>
                    <div id="temp-estado" class="estado-indicador bajo">
                        <span class="estado-texto">BAJO</span>
                    </div>
                    <div class="umbral-info">
                        <small>Umbral de peligro: <strong>45Â°C</strong></small>
                    </div>
                </div>

                <div class="medidor-card">
                    <div class="medidor-header">
                        <span class="icono">ğŸ’¨</span>
                        <h3>Humo / Gases</h3>
                    </div>
                    <div class="medidor-valor">
                        <span id="humo-valor" class="valor-grande">--</span>
                        <span class="unidad">ppm</span>
                    </div>
                    <div id="humo-estado" class="estado-indicador bajo">
                        <span class="estado-texto">BAJO</span>
                    </div>
                    <div class="umbral-info">
                        <small>Umbral de peligro: <strong>600 ppm</strong></small>
                    </div>
                </div>
            </div>
        </section>

        <section class="alertas-section">
            <h2>ğŸš¨ Registro de Alertas</h2>
            <div id="lista-alertas" class="lista-alertas">
                <p class="sin-alertas">No hay alertas registradas</p>
            </div>
        </section>

        <section class="graficos-section">
            <h2>ğŸ“ˆ HistÃ³rico de Lecturas</h2>
            
            <div class="graficos-grid">
                <div class="grafico-container">
                    <h3>Temperatura (Ãšltimos 50 registros)</h3>
                    <canvas id="grafico-temperatura"></canvas>
                </div>
                
                <div class="grafico-container">
                    <h3>Humo (Ãšltimos 50 registros)</h3>
                    <canvas id="grafico-humo"></canvas>
                </div>
            </div>
        </section>
    </div>

    <footer>
        <p>Sistema Multisensorial de Alerta Inclusiva para Aulas | Basado en Arduino + MQ-2 + DHT11</p>
        <p><small>Proyecto de IngenierÃ­a de Software - Universidad de Milagro</small></p>
    </footer>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>